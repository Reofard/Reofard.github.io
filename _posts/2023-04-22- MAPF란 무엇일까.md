---
title:  "MAPF란 무엇일까"
excerpt: "Robot"

categories:
  - Path_Finding

tags:
  - [MAPF, Path Finding, Multi-Robot]

toc: true
toc_sticky: true
layout: post
use_math: true
 
date: 2023-04-22
last_modified_at: 2023-04-22
---

최근에 로봇 관제 업무를 담당하게 되었는데, 그중 다수의 로봇을 부딫치지 않고 각자의 목적지까지 보내야 하는 미션이 있었다. 이번 Article에서는 여러 접근 방식중 MAPF라는 분야에 대해 우선 공부하고 정리하는 글을 쓰고자 한다. 해당 내용은 내 생각 + MAPF 정리 논문인 [Multi-Agent Pathfinding: Definitions, Variants, and Benchmarks](https://arxiv.org/abs/1906.08291)을 참고하여 작성해보려고 한다.


<br>

# 일단 문제 정의부터

우선 MAPF가 주로 연구되는 도메인은 Warehouse, autonomous vehicle등이 있다. 이러한 도메인의 특징은 다수의 agent, 로봇이 존재하는 환경에서 각 agent마다 경로탐색시 다른 agent를 고려해야 한다는 것이다. 이러한 제약조건을 가지고 각각의 로봇의 경로는 효율적이면서 충돌이 없어야 하는데, 이러한 조건을 충족하는 경로를 생성하는 알고리즘이 바로 MAPF(Multi Agent Path Finding)이다.

즉 MAPF란 복수의 Agent가 **충돌없이** 각각의 goal까지 가는데 필요한 **효율적인 경로**를 탐색하는 알고리즘인 것이다.


<br>

# Classical MAPF란?

우선 가장 기본적인 MAPF의 정의와 
지금까지 문제 사항과 MAPF에 대해 간단하게 알아보았다. 이제 가장 기본적인 MAPF인 Classical MAPF에 대해 수학적으로 정의해보면서 정리해보려고 한다. 앞서 언급한 논문 [Multi-Agent Pathfinding: Definitions, Variants, and Benchmarks](https://arxiv.org/abs/1906.08291)에 따르면 K개의 Agent가 있을 때 Classical MAPF 문제의 제약조건은 다음과 같다.

1. 이산시간을 기반으로 계산
2. 각 시간마다 agent는 하나의 그래프 상 정점 위에 존재
3. 각 시간마다 agent는 단일 action을 수행(이웃노드 이동, 대기)

위의 제약조건은 다음 영상에서 잘 확인 할 수 있다. 해당 영상은 MAPF 논문중 하나인 [PIBT](https://kei18.github.io/pibt2/)의 구현 영상인데, 나중에 다시한번 다뤄보려고 한다.

<iframe title="vimeo-player" src="https://player.vimeo.com/video/645887407?h=ac1bd95048" width="640" height="360" frameborder="0"    allowfullscreen></iframe>

<br>

이러한 제약조건 안에서 MAPF 함수의 input은 아래 식과 같이 정의한다고 한다.

> $$ \langle G, s, t \rangle \\ G = (V, E) \\ s : [s_1, s_2, ... , s_k], s_i \in V \\ e : [e_1, e_2, ... , e_k], e_i \in V $$

위 튜플의 각각의 요소는 각각 $G$는 단방향 그래프, $s$는 agent별 정점 집합,  $e$는 agent별 goal 정점 집합이다. Classical MAPF에서는 각각의 에이전트가 단위시간마다 하나의 action $a$를 할 수 있다. action은 아래 식과 같이 vertex에서 이웃 vertex로 이동 혹은 현재 위치에 대기하는것으로 정의된다.

> $$a : V \rightarrow V \\ a(v) = v' \\ (v, v') \in E$$

마지막으로 Classical MAPF에선 output이 모든 에이전트가 source로부터 goal까지 가는데 필요한 경로를 일련의 action인 $\pi$로 정의하고 식은 아래와 같다.

>$$\pi = (a_1, a_2, ..., a_n)$$

즉 i번째 에이전트의 경로를 $\pi_i$라고 할 때 $x$시간 뒤의 i번째 agent의 위치를 $\pi_i[x] = a_x(a_{x-1}(...a_1(s_i)))$로 나타낼 수 있는 것이다.

<br>

### **Types of Conflicts in Classical MAPF**

MAPF는 다중 agent에 대해 **충돌이 없는** 각 agent별 경로를 구하기 위한 알고리즘이다. 그렇기 때문에 과연 충돌을 어떻게 정의할 것 인지 먼저 짚고 넘어가자.

아직안씀